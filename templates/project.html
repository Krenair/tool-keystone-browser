{% extends "layout.html" %}

{% block title %}Project {{ project }} - Keystone browser{% endblock %}

{% block content %}
<ol class="breadcrumb">
  <li><a href="{{ url_for('index') }}">Projects</a></li>
  <li class="active">{{ project }}</li>
</ol>

{% if admins or users or servers %}
<div class="panel-group" role="tablist">
  {% if admins %}
  <div class="panel panel-default">
    <div class="panel-heading" role="tab">
      <h3 class="panel-title">
        <span class="glyphicon glyphicon-user"></span>
        Administrators
      </h3>
    </div>
    <div class="panel-body">
      <ul class="list-unstyled column-list">
        {% for u in admins|sort(attribute='cn') %}
        <li><a href="{{ url_for('user', uid=u.uid) }}">{{ u.cn }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}
  {% if users %}
  <div class="panel panel-default">
    <div id="users-heading" class="panel-heading" role="tab">
      <h3 class="panel-title">
        <a href="#users-body" class="collapsed" role="button" data-toggle="collapse" aria-expanded="false" aria-controls="users-body">
          <span class="glyphicon glyphicon-user"></span>
          Users
        </a>
      </h3>
    </div>
    <div id="users-body" class="panel-body panel-collapse collapse" role="tabpanel" aria-labelledby="users-heading">
      <ul class="list-unstyled column-list">
        {% for u in users|sort(attribute='cn') %}
        <li><a href="{{ url_for('user', uid=u.uid) }}">{{ u.cn }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}
  {% if servers %}
  <div class="panel panel-default">
    <div class="panel-heading" role="tab">
      <h3 class="panel-title">
        <span class="glyphicon glyphicon-hdd"></span>
        Instances
      </h3>
    </div>
    <table class="table table-condensed table-hover">
      <thead>
        <tr>
          <th>FQDN</th>
          <th>Type</th>
          <th>Image</th>
          <th>IP</th>
          <th>CPUs</th>
          <th>RAM</th>
          <th>Storage</th>
          <th>Last modified</th>
        </tr>
      </thead>
      <tbody>
        {% for server in servers %}
          {% set image = images[server.image.id]|default('') %}
          {% set flavor = flavors[server.flavor.id]|default('') %}
        <tr>
          <td>{{ server.name }}.{{ project }}.eqiad.wmflabs</td>
          <td>{{ flavor.name }}</td>
          <td>{{ image.name|default('UNKNOWN') }}</td>
          <td>{{ server.addresses.public[0].addr }}</td>
          <td>{{ flavor.vcpus }}</td>
          <td>{{ flavor.ram }}M</td>
          <td>{{ flavor.disk }}G</td>
          <td>{{ server.updated }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</div>
{% else %}
<p>Unknown project '{{ project }}'. Are you just guessing?</p>
{% endif %}
{% endblock %}
